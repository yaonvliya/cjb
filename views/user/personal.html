<style>
    #personal-detailForm .layui-input {
        border: none;
    }
</style>

<div class="animated fadeInRight">
    <div class="search-box">
        <form class="layui-form" id="personal-search-form" lay-filter="personal-search-form">
            <div class="basic-search">
                <div class="common-input-inline">
                    <label class="search-form-label">手机号码：</label>
                    <div class="layui-input-inline">
                        <input class="layui-input" name="safeLoginAccount"/>
                    </div>
                </div>
                <div class="common-input-inline">
                    <label class="search-form-label">真实姓名：</label>
                    <div class="layui-input-inline">
                        <input class="layui-input" name="realname"/>
                    </div>
                </div>
                <div class="common-input-inline">
                    <label class="search-form-label">是否已实名：</label>
                    <div class="layui-input-inline">
                        <select name="realnameStatus">
                            <option value="">全部</option>
                            <option value=true>已实名</option>
                            <option value=false>未实名</option>
                        </select>
                    </div>
                </div>
                <div class="common-input-inline">
                    <label class="search-form-label">用户状态：</label>
                    <div class="layui-input-inline">
                        <select name="frozenFlag">
                            <option value="">全部</option>
                            <option value="false">正常</option>
                            <option value="true">冻结</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="more-search">
                <div class="common-input-inline">
                    <label class="search-form-label">用户角色：</label>
                    <div class="layui-input-inline">
                        <select name="userRole">
                            <option value="">全部</option>
                            <option value="investor">投资人</option>
                            <option value="loaner">借款人</option>
                            <option value="compensatory">代偿户</option>
                        #*<option value="3">营销户</option>
                        <option value="4">手续费户</option>
                        <option value="7">平台资金账户</option>*#
                        </select>
                    </div>
                </div>
            </div>
            <div class="layui-btn-group">
                <button type="button" class="layui-btn layui-btn-primary" id="personal-search"><i class="layui-icon">&#xe615;</i>
                    查询
                </button>
                <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                <button type="button" class="layui-btn layui-btn-primary" data-show="off"
                        onclick="showMoreSearch(this,'personal-search-form')"><i class="layui-icon">&#xe61a;</i> 更多
                </button>
            </div>
        </form>
    </div>

    <table id="personalUser" class="layui-hide" lay-filter="personalUser"></table>
</div>

<form id="freezePersonalUserForm" class="layui-form p10 hide">
    <input type="hidden" name="userId">
    <div class="layui-form-item">
        <label class="layui-form-label">冻结原因：</label>
        <div class="layui-input-inline">
            <textarea class="layui-textarea" name="frozenReason" lay-verify="required"></textarea>
        </div>
    </div>
    <div class="bottom-buttons">
        <button type="button" class="layui-btn" lay-submit lay-filter="freezePersonalUserSubmit">确认提交</button>
    </div>
</form>

<div id="personal-detailWin" class="right-win animated fadeInRight w600">
    <div class="right-win-top">
        <a href="javascript:closeRightWin('personal-detailWin');" title="关闭"><i
            class="layui-icon close-right-win">&#x1006;</i></a>
        <span class="right-win-title">个人用户信息</span>
    </div>
    <div class="right-win-content-box">
        <div class="slimScrollDiv win-content">
            <form class="layui-form" style="white-space:nowrap;" id="personal-detailForm">
                <fieldset class="layui-elem-field layui-field-title">
                    <legend>基本信息</legend>
                    <div class="layui-field-box">
                        <div class="layui-form-item">
                            <label class="layui-form-label w160">手机号：</label>
                            <div class="layui-input-inline">
                                <input class="layui-input" name="safeLoginAccount"/>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class=" layui-form-label w160">邮箱：</label>
                            <div class="layui-input-inline">
                                <input class="layui-input" name="safeEmail"/>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label w160">用户角色：</label>
                            <div class="layui-input-inline">
                                <input class="layui-input" name="userRole"/>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class=" layui-form-label w160">注册来源：</label>
                            <div class="layui-input-inline">
                                <input class="layui-input" name="registerFrom"/>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class=" layui-form-label w160">注册渠道：</label>
                            <div class="layui-input-inline">
                                <input class="layui-input" name="registerTerminal"/>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class=" layui-form-label w160">注册时间：</label>
                            <div class="layui-input-inline">
                                <input class="layui-input" name="registerTime"/>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class=" layui-form-label w160">实名时间：</label>
                            <div class="layui-input-inline">
                                <input class="layui-input" name="realnameTime"/>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label w160">实名状态：</label>
                            <div class="layui-input-inline">
                                <input class="layui-input" name="realnameStatus"/>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label w160">绑卡状态：</label>
                            <div class="layui-input-inline">
                                <input class="layui-input" name="bindcardStatus"/>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class=" layui-form-label w160">邀请人ID：</label>
                            <div class="layui-input-inline">
                                <input class="layui-input" name="inviteUserId"/>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class=" layui-form-label w160">状态：</label>
                            <div class="layui-input-inline">
                                <input class="layui-input" name="frozenFlag"/>
                            </div>
                        </div>
                    </div>
                </fieldset>
                <fieldset class="layui-elem-field layui-field-title">
                    <legend>实名信息</legend>
                    <div class="layui-field-box">
                        <div class="layui-form-item">
                            <label class=" layui-form-label w160">实名账户：</label>
                            <div class="layui-input-inline">
                                <input class="layui-input" name="depositAccount"/>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class=" layui-form-label w160">真实姓名：</label>
                            <div class="layui-input-inline">
                                <input class="layui-input" name="realName"/>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class=" layui-form-label w160">身份证号：</label>
                            <div class="layui-input-inline">
                                <input class="layui-input" name="safeCert"/>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class=" layui-form-label w160">开户银行：</label>
                            <div class="layui-input-inline">
                                <input class="layui-input" name="bankCode"/>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class=" layui-form-label w160">银行卡号：</label>
                            <div class="layui-input-inline">
                                <input class="layui-input" name="bankCardNo"/>
                            </div>
                        </div>
                    </div>
                </fieldset>
            </form>
        </div>
        <div class="right-win-drag" data-winId="personal-detailWin"></div>
    </div>

</div>

<script type="text/html" id="userStatusTpl">
    {{# if(!d.frozenFlag){ }}
    正常
    {{# } else { }}
    冻结
    {{# } }}
</script>

<script type="text/html" id="personalUserBar">
    <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="detail"><i class="layui-icon">&#xe615;</i>详情</a>
    {{# if(!d.frozenFlag){ }}
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="frozen">冻结</a>
    {{# } else { }}
    <a class="layui-btn layui-btn-normal layui-btn-xs" lay-event="enable">解冻</a>
    {{# } }}
</script>

<script type="text/javascript">

    $(document).ready(function () {

        layform.render(null, "personal-search-form");
        var index;

        var personalTableIns = LayTableUtil.render({
            elem: '#personalUser'
            , cols: [[ //表头
                {field: 'safeLoginAccount', title: '注册手机号', sort: true, width: 130, fixed: 'left'}
                , {
                    field: 'registerFrom', title: '注册来源', templet: function (d) {
                        return d.registerFrom.message
                    }
                }
                , {field: 'registerTerminal', title: '注册终端', width: 130}
                , {
                    field: 'registerTime', title: '注册时间', width: 180, templet: function (d) {
                        return DateUtils.longToDateString(d.registerTime)
                    }
                }
                , {
                    field: 'userRole', title: '用户角色', width: 100, templet: function (d) {
                        return d.userRole.message
                    }
                }
                , {
                    field: 'openDepositStatus', title: '实名状态', width: 100, templet: function (d) {
                        return d.openDepositStatus != null ? d.openDepositStatus.message : "已销户"
                    }
                }
                , {field: 'realName', title: '真实姓名'}
                , {field: 'frozenFlag', title: '状态', width: 80, templet: '#userStatusTpl'}
                , {field: 'depositAccount', title: '实名账户', width: 180}
                , {title: '操作', fixed: 'right', align: 'center', toolbar: '#personalUserBar', width: 140}

            ]]
            , url: userManagerApi.searchPersonalUser
            , page: true
            , id: 'personalUserTable'
        })

        //监听工具条
        laytable.on('tool(personalUser)', function (obj) {
            var data = obj.data;
            if (obj.event === 'detail') {
                var jsonParam = JSON.stringify({"userId": data.userId});
                var result = AjaxUtil.ajaxPost(userManagerApi.getUserDetail, jsonParam);
                if (result) {
                    var resData = result.data;
                    loadFormData("#personal-detailForm", resData);
                    $("#personal-detailForm").find("[name='registerTime']").val(DateUtils.longToDateString(resData.registerTime));
                    $("#personal-detailForm").find("[name='realnameTime']").val(DateUtils.longToDateString(resData.openDepositTime));
                    $("#personal-detailForm").find("[name='registerFrom']").val(resData.registerFrom.message);
                    $("#personal-detailForm").find("[name='userRole']").val(resData.userRole.message);
                    $("#personal-detailForm").find("[name='realnameStatus']").val(resData.openDepositStatus.message);
                    $("#personal-detailForm").find("[name='bindcardStatus']").val(resData.bindCardStatus.message);
                    $("#personal-detailForm").find("[name='bankCode']").val(resData.bankCode);
                    if (resData.frozenFlag) {
                        $("#personal-detailForm").find("[name='frozenFlag']").val("冻结");
                    } else {
                        $("#personal-detailForm").find("[name='frozenFlag']").val("正常");
                    }

                    openRightWin('personal-detailWin');
                }

            } else if (obj.event === 'frozen') {
                index = LayerUtil.open("冻结用户", $("#freezePersonalUserForm"), '400px');
                $("#freezePersonalUserForm")[0].reset();
                $("#freezePersonalUserForm").find("[name='userId']").val(data.userId);
            } else if (obj.event === 'enable') {
                layer.confirm('确认解冻此用户', function (index) {
                    var jsonParam = JSON.stringify({"userId": data.userId});
                    var result = AjaxUtil.ajaxPost(userManagerApi.unfreezeUser, jsonParam);
                    if (result) {
                        layer.close(index);
                        layer.msg("解冻成功");
                        LayTableUtil.refresh(personalTableIns, "personal-search-form");
                    }
                });
            }
        });

        layform.on('submit(freezePersonalUserSubmit)', function (data) {
            var result = AjaxUtil.ajaxPost(userManagerApi.freezeUser, JSON.stringify(data.field));
            if (result) {
                LayerUtil.close(index);
                layer.msg("冻结成功");
                LayTableUtil.refresh(personalTableIns, "personal-search-form");
            }
        });

        $('#personal-search').on('click', function () {
            LayTableUtil.refresh(personalTableIns, "personal-search-form");
        });

        // SearchForm绑定回车事件
        $("#personal-search-form").bind('keypress', function (event) {
            if (event.keyCode == "13") {
                $('#personal-search').click();
            }
        });

        // 点击遮罩层关闭窗口
        $('.mask').click(function () {
            closeRightWin('personal-detailWin');
        });
    });

    function loadFormData(elem, data) {
        layui.each(data, function (k, v) {
            var selector = '[name="' + k + '"]';
            var elt = $(elem).find(selector);
            elt.val(v);
        });
    }


</script>